<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01//EN" "about:legacy-compat">
<html lang="en"><head profile="http://dublincore.org/documents/2008/08/04/dc-html/"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>Cache Digests for HTTP/2</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"><style type="text/css">
      body {
        padding-top: 80px;
        padding-bottom: 80px;
        position: relative;
      }
      .table.header th, .table.header td {
        border-top: none;
        padding: 0;
      }
      #rfc\.meta {
        width: 40%;
        float: right
      }
      #rfc\.toc > ul li {
        list-style: none;
      }
      .container .nav-sublist {
        padding-left: 20px;
        padding-right: 10px;
        font-size: 90%;
      }
      .container .navbar-brand {
        padding-top: 0;
      }
      .container .nav > li > a {
        padding: 10px 7px 5px 15px;
        display: inline-block;
      }
      .container .nav > li > a + a {
        padding: 10px 15px 5px 7px;
        display: inline-block;
      }
      .container .nav > li > a {
        padding: 5px 10px;
      }
      .filename {
        color: rgb(119, 119, 119);
        font-size: 23px;
        font-weight: normal;
        height: auto;
        line-height: 23px;
      }
      dl {
        margin-left: 1em;
      }
      dl.dl-horizontal: {
        margin-left: 0;
      }
      dl > dt {
        float: left;
        margin-right: 1em;
      }
      dl.nohang > dt {
        float: none;
      }
      dl > dd {
        margin-bottom: .5em;
      }
      dl.compact > dd {
        margin-bottom: 0em;
      }
      dl > dd > dl {
        margin-top: 0.5em;
        margin-bottom: 0em;
      }
      ul.empty {
        list-style-type: none;
      }
      ul.empty li {
        margin-top: .5em;
      }
      td.reference {
        padding-right: 1em;
        vertical-align: top;
      }
      .feedback {
        position: fixed;
        bottom: 5px;
        right: 5px;
      }
      .fbbutton {
        margin-left: 5px;
      }
      h1 a, h2 a, h3 a, h4 a, h5 a, h6 a {
        color: rgb(51, 51, 51);
      }
    </style><link rel="Author" href="#rfc.authors"><link rel="Copyright" href="#rfc.copyrightnotice"><link rel="Chapter" title="1 Introduction" href="#rfc.section.1"><link rel="Chapter" title="2 The CACHE_DIGEST Frame" href="#rfc.section.2"><link rel="Chapter" title="3 IANA Considerations" href="#rfc.section.3"><link rel="Chapter" title="4 Security Considerations" href="#rfc.section.4"><link rel="Chapter" href="#rfc.section.5" title="5 References"><link rel="Appendix" title="A Acknowledgements" href="#rfc.section.A"><meta name="generator" content="https://github.com/mnot/RFCBootstrap XSLT vendor: Saxonica http://www.saxonica.com/"><meta name="keywords" content="Internet-Draft"><link rel="schema.dct" href="http://purl.org/dc/terms/"><meta name="dct.creator" content="Oku, K."><meta name="dct.creator" content="Nottingham, M."><meta name="dct.identifier" content="urn:ietf:id:draft-kazuho-h2-cache-digest-00"><meta name="dct.issued" scheme="ISO8601" content="2016-01-07"><meta name="dct.abstract" content="This specification defines a HTTP/2 frame type to allow clients to inform the server of their cache’s contents. Servers can then use this to inform their choices of what to push to clients."><meta name="description" content="This specification defines a HTTP/2 frame type to allow clients to inform the server of their cache’s contents. Servers can then use this to inform their choices of what to push to clients."></head><body><div class="container" id="top"><div class="row"><div class="col-md-4 col-md-push-8 hidden-sm hidden-xs" role="navigation"><div class="navbar"><div class="navbar-brand"><a href="#top">Internet-Draft</a></div><br clear="all"><div class=""><div id="rfc.toc"><ul class="nav"><li><a href="#rfc.section.1">1.</a>&nbsp;&nbsp;&nbsp;<a href="#introduction">Introduction</a><ul><li><a href="#rfc.section.1.1">1.1</a>&nbsp;&nbsp;&nbsp;<a href="#notational-conventions">Notational Conventions</a></li></ul></li><li><a href="#rfc.section.2">2.</a>&nbsp;&nbsp;&nbsp;<a href="#the-cachedigest-frame">The CACHE_DIGEST Frame</a><ul><li><a href="#rfc.section.2.1">2.1</a>&nbsp;&nbsp;&nbsp;<a href="#computing">Computing the Digest-Value</a></li></ul></li><li><a href="#rfc.section.3">3.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-considerations">IANA Considerations</a></li><li><a href="#rfc.section.4">4.</a>&nbsp;&nbsp;&nbsp;<a href="#security-considerations">Security Considerations</a></li><li><a href="#rfc.section.5">5.</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references">References</a><ul><li><a href="#rfc.section.5.1">5.1</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references.1">Normative References</a></li><li><a href="#rfc.section.5.2">5.2</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references.2">Informative References</a></li></ul></li><li><a href="#rfc.section.A">A.</a>&nbsp;&nbsp;&nbsp;<a href="#acknowledgements">Acknowledgements</a></li><li><a href="#rfc.authors">Authors' Addresses</a></li></ul></div></div></div></div><div class="col-md-8 col-md-pull-4 main" role="main"><table class="table table-condensed header" id="rfc.headerblock"><tbody><tr><td class="text-left">Network Working Group</td><td class="text-right">K. Oku</td></tr><tr><td class="text-left">Internet-Draft</td><td class="text-right">DeNA Co, Ltd.</td></tr><tr><td class="text-left">Intended status: Informational</td><td class="text-right">M. Nottingham</td></tr><tr><td class="text-left">Expires: July 10, 2016</td><td class="text-right">January 7, 2016</td></tr></tbody></table><div id="rfc.title"><h1>Cache Digests for HTTP/2</h1><div class="filename">draft-kazuho-h2-cache-digest-00</div></div><hr><h2 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h2><div class="lead"><p>This specification defines a HTTP/2 frame type to allow clients to inform the server of their cache’s contents. Servers can then use this to inform their choices of what to push to clients.</p></div><h2 id="rfc.note.1"><a href="#rfc.note.1">Note to Readers</a></h2><p>The issues list for this draft can be found at <a href="https://github.com/mnot/I-D/labels/h2-cache-digest">https://github.com/mnot/I-D/labels/h2-cache-digest</a>.</p><p>The most recent (often, unpublished) draft is at <a href="https://mnot.github.io/I-D/h2-cache-digest/">https://mnot.github.io/I-D/h2-cache-digest/</a>.</p><p>Recent changes are listed at <a href="https://github.com/mnot/I-D/commits/gh-pages/h2-cache-digest">https://github.com/mnot/I-D/commits/gh-pages/h2-cache-digest</a>.</p><div id="rfc.status"><h2><a href="#rfc.status">Status of this Memo</a></h2><p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p><p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF). Note that other groups may also distribute working documents as Internet-Drafts. The list of current Internet-Drafts is at <a href="http://datatracker.ietf.org/drafts/current/">http://datatracker.ietf.org/drafts/current/</a>.</p><p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time. It is inappropriate to use Internet-Drafts as reference material or to cite them other than as “work in progress”.</p><p>This Internet-Draft will expire on July 10, 2016.</p></div><div id="rfc.copyrightnotice"><h2><a href="#rfc.copyrightnotice">Copyright Notice</a></h2><p>Copyright © 2016 IETF Trust and the persons identified as the document authors. All rights reserved.</p><p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of publication of this document. Please review these documents carefully, as they describe your rights and restrictions with respect to this document. Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p></div><div id="introduction"><h2 id="rfc.section.1" class="np"><a href="#rfc.section.1">1.</a>&nbsp;<a href="#introduction">Introduction</a></h2><div id="rfc.section.1.p.1"><p>HTTP/2 <a href="#RFC7540"><cite title="Hypertext Transfer Protocol Version 2 (HTTP/2)">[RFC7540]</cite></a> allows a server to “push” synthetic request/response pairs into a client’s cache optimistically. While there is strong interest in using this facility to improve perceived Web browsing performance, it is sometimes counterproductive because the client might already have cached the “pushed” response.</p></div><div id="rfc.section.1.p.2"><p>When this is the case, the bandwidth used to “push” the response is effectively wasted, and represents opportunity cost, because it could be used by other, more relevant responses. HTTP/2 allows a stream to be cancelled by a client using a RST_STREAM frame in this situation, but there is still at least one round trip of potentially wasted capacity even then.</p></div><div id="rfc.section.1.p.3"><p>This specification defines a HTTP/2 frame type to allow clients to inform the server of their cache’s contents using a Golumb-Rice Coded Set. Servers can then use this to inform their choices of what to push to clients.</p></div><div id="notational-conventions"><h3 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1</a>&nbsp;<a href="#notational-conventions">Notational Conventions</a></h3><div id="rfc.section.1.1.p.1"><p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in <a href="#RFC2119"><cite title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</cite></a>.</p></div></div></div><div id="the-cachedigest-frame"><h2 id="rfc.section.2"><a href="#rfc.section.2">2.</a>&nbsp;<a href="#the-cachedigest-frame">The CACHE_DIGEST Frame</a></h2><div id="rfc.section.2.p.1"><p>The CACHE_DIGEST frame type is 0xf1. NOTE: This is an experimental value; if standardised, a permanent value will be assigned.</p></div><div id="rfc.section.2.p.2"><p>A CACHE_DIGEST frame can be sent from a client to a server on any stream in the “open” state, and conveys a digest of the contents of the cache associated with that stream, as explained in <a href="#computing" title="Computing the Digest-Value">Section&nbsp;2.1</a>.</p></div><div id="rfc.section.2.p.3"><p>In typical use, a client will send CACHE_DIGEST immediately after the first request on a connection for a given origin, on the same stream, because there is usually a short period of inactivity then, and servers can benefit most when they understand the state of the cache before they begin pushing associated assets (e.g., CSS, JavaScript and images).</p></div><div id="rfc.section.2.p.4"><p>Clients MAY send CACHE_DIGEST at other times, but servers ought not expect frequent updates; instead, if they wish to continue to utilise the digest, they will need update it with responses sent to that client on the connection.</p></div><div id="rfc.section.2.p.5"><p>Servers MUST NOT use any but the most recent CACHE_DIGEST for a given origin as current, and MUST treat an empty Digest-Value as effectively clearing all stored digests for that origin.</p></div><div id="rfc.section.2.p.6"><p>CACHE_DIGEST has no defined meaning when sent from servers to clients, and MAY be ignored.</p></div><div id="rfc.figure.u.1"><pre>
+---------------------------------------------------------------+
|         Digest-Value? (*)                    ...
+---------------------------------------------------------------+
</pre></div><div id="rfc.section.2.p.7" class="avoidbreakafter"><p>The CACHE_DIGEST frame payload has the following fields:</p></div><div id="rfc.section.2.p.8"><ul><li>Digest-Value: An optional sequence of octets containing the digest as computed in <a href="#computing" title="Computing the Digest-Value">Section&nbsp;2.1</a>.</li></ul></div><div id="computing"><h3 id="rfc.section.2.1"><a href="#rfc.section.2.1">2.1</a>&nbsp;<a href="#computing">Computing the Digest-Value</a></h3><div id="rfc.section.2.1.p.1"><p>The set of URLs that is used to compute Digest-Value MUST only include URLs that share origins <a href="#RFC6454"><cite title="The Web Origin Concept">[RFC6454]</cite></a> with the stream that CACHE_DIGEST is sent on, and they MUST be fresh <a href="#RFC7234"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Caching">[RFC7234]</cite></a>.</p></div><div id="rfc.section.2.1.p.2"><p>A client MAY choose a subset of the available stored responses to include in the set. Additionally, it MUST choose a parameter, <tt>P</tt>, that indicates the probability of a false positive it is willing to tolerate, expressed as <tt>1/P</tt>.</p></div><div id="rfc.section.2.1.p.3"><p><tt>P</tt> MUST be a power of 2.</p></div><div id="rfc.section.2.1.p.4" class="avoidbreakafter"><p>To compute a digest-value for the set <tt>URLs</tt> and <tt>P</tt>:</p></div><div id="rfc.section.2.1.p.5"><ol><li>Let N be the count of <tt>URLs</tt>’ members, rounded up to power of 2.</li><li>Let <tt>hash-values</tt> be an empty array of integers.</li><li>Append 0 to <tt>hash-values</tt>.</li><li>For each <tt>URL</tt> in URLs, follow these steps: <ol><li>Convert <tt>URL</tt> to an ASCII string by percent-encoding as appropriate <a href="#RFC3986"><cite title="Uniform Resource Identifier (URI): Generic Syntax">[RFC3986]</cite></a>.</li><li>Let <tt>key</tt> be the SHA-256 message digest <a href="#RFC6234"><cite title="US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)">[RFC6234]</cite></a> of URL, expressed as an integer.</li><li>Append <tt>key</tt> modulo ( <tt>N</tt> * <tt>P</tt> ) to <tt>hash-values</tt>.</li></ol></li><li>Sort <tt>hash-values</tt> in ascending order.</li><li>Let <tt>digest</tt> be an empty array of bits.</li><li>Write log base 2 of <tt>N</tt> and <tt>P</tt> to <tt>digest</tt> as octets.</li><li>For each <tt>V</tt> in <tt>hash-values</tt>: <ol><li>Let <tt>W</tt> be the value following <tt>V</tt> in <tt>hash-values</tt>.</li><li>If <tt>W</tt> and <tt>V</tt> are equal, continue to the next <tt>V</tt>.</li><li>Let <tt>D</tt> be the result of <tt>W - V - 1</tt>.</li><li>Let <tt>Q</tt> be the integer result of <tt>D / P</tt>.</li><li>Let <tt>R</tt> be the result of <tt>D modulo P</tt>.</li><li>Write <tt>Q</tt> ‘1’ bits to <tt>digest</tt>.</li><li>Write 1 ‘0’ bit to <tt>digest</tt>.</li><li>Write <tt>R</tt> to <tt>digest</tt> as binary, using log2(P) bits.</li><li>If <tt>V</tt> is the second-to-last member of <tt>hash-values</tt>, stop iterating through <tt>hash-values</tt> and continue to the next step.</li></ol></li><li>If the length of <tt>digest</tt> is not a multiple of 8, pad it with 1s until it is.</li></ol></div></div></div><div id="iana-considerations"><h2 id="rfc.section.3"><a href="#rfc.section.3">3.</a>&nbsp;<a href="#iana-considerations">IANA Considerations</a></h2><div id="rfc.section.3.p.1"><p>This draft currently has no requirements for IANA. If the CACHE_DIGEST frame is standardised, it will need to be assigned a frame type.</p></div></div><div id="security-considerations"><h2 id="rfc.section.4"><a href="#rfc.section.4">4.</a>&nbsp;<a href="#security-considerations">Security Considerations</a></h2><div id="rfc.section.4.p.1"><p>The contents of a User Agent’s cache can be used to re-identify or “fingerprint” the user over time, even when other identifiers (e.g., Cookies <a href="#RFC6265"><cite title="HTTP State Management Mechanism">[RFC6265]</cite></a>) are cleared.</p></div><div id="rfc.section.4.p.2"><p>CACHE_DIGEST allows such cache-based fingerprinting to become passive, since it allows the server to discover the state of the client’s cache without any visible change in server behaviour.</p></div><div id="rfc.section.4.p.3"><p>As a result, clients MUST mitigate for this threat when the user attempts to remove identifiers (e.g., “clearing cookies”). This could be achieved in a number of ways; for example: by clearing the cache, by changing one or both of N and P, or by adding new, synthetic entries to the digest to change its contents.</p></div><div id="rfc.section.4.p.4"><p>TODO: discuss how effective the suggested mitigations actually would be.</p></div><div id="rfc.section.4.p.5"><p>Additionally, User Agents SHOULD NOT send CACHE_DIGEST when in “privacy mode.”</p></div></div><h2 id="rfc.references"><a id="rfc.section.5" href="#rfc.section.5">5.</a> References</h2><h3 id="rfc.references.1"><a href="#rfc.section.5.1" id="rfc.section.5.1">5.1</a> Normative References</h3><dl class="reference"><dt id="RFC2119">[RFC2119]</dt><dd>Bradner, S., “<a href="http://www.rfc-editor.org/info/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>”, BCP&nbsp;14, RFC&nbsp;2119, <a href="http://dx.doi.org/10.17487/RFC2119">DOI&nbsp;10.17487/RFC2119</a>, March&nbsp;1997, &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.</dd><dt id="RFC3986">[RFC3986]</dt><dd>Berners-Lee, T., Fielding, R., and L. Masinter, “<a href="http://www.rfc-editor.org/info/rfc3986">Uniform Resource Identifier (URI): Generic Syntax</a>”, STD&nbsp;66, RFC&nbsp;3986, <a href="http://dx.doi.org/10.17487/RFC3986">DOI&nbsp;10.17487/RFC3986</a>, January&nbsp;2005, &lt;<a href="http://www.rfc-editor.org/info/rfc3986">http://www.rfc-editor.org/info/rfc3986</a>&gt;.</dd><dt id="RFC6234">[RFC6234]</dt><dd>Eastlake 3rd, D. and T. Hansen, “<a href="http://www.rfc-editor.org/info/rfc6234">US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)</a>”, RFC&nbsp;6234, <a href="http://dx.doi.org/10.17487/RFC6234">DOI&nbsp;10.17487/RFC6234</a>, May&nbsp;2011, &lt;<a href="http://www.rfc-editor.org/info/rfc6234">http://www.rfc-editor.org/info/rfc6234</a>&gt;.</dd><dt id="RFC6454">[RFC6454]</dt><dd>Barth, A., “<a href="http://www.rfc-editor.org/info/rfc6454">The Web Origin Concept</a>”, RFC&nbsp;6454, <a href="http://dx.doi.org/10.17487/RFC6454">DOI&nbsp;10.17487/RFC6454</a>, December&nbsp;2011, &lt;<a href="http://www.rfc-editor.org/info/rfc6454">http://www.rfc-editor.org/info/rfc6454</a>&gt;.</dd><dt id="RFC7234">[RFC7234]</dt><dd>Fielding, R., Ed., Nottingham, M., Ed., and J. Reschke, Ed., “<a href="http://www.rfc-editor.org/info/rfc7234">Hypertext Transfer Protocol (HTTP/1.1): Caching</a>”, RFC&nbsp;7234, <a href="http://dx.doi.org/10.17487/RFC7234">DOI&nbsp;10.17487/RFC7234</a>, June&nbsp;2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7234">http://www.rfc-editor.org/info/rfc7234</a>&gt;.</dd><dt id="RFC7540">[RFC7540]</dt><dd>Belshe, M., Peon, R., and M. Thomson, Ed., “<a href="http://www.rfc-editor.org/info/rfc7540">Hypertext Transfer Protocol Version 2 (HTTP/2)</a>”, RFC&nbsp;7540, <a href="http://dx.doi.org/10.17487/RFC7540">DOI&nbsp;10.17487/RFC7540</a>, May&nbsp;2015, &lt;<a href="http://www.rfc-editor.org/info/rfc7540">http://www.rfc-editor.org/info/rfc7540</a>&gt;.</dd></dl><h3 id="rfc.references.2"><a href="#rfc.section.5.2" id="rfc.section.5.2">5.2</a> Informative References</h3><dl class="reference"><dt id="RFC6265">[RFC6265]</dt><dd>Barth, A., “<a href="http://www.rfc-editor.org/info/rfc6265">HTTP State Management Mechanism</a>”, RFC&nbsp;6265, <a href="http://dx.doi.org/10.17487/RFC6265">DOI&nbsp;10.17487/RFC6265</a>, April&nbsp;2011, &lt;<a href="http://www.rfc-editor.org/info/rfc6265">http://www.rfc-editor.org/info/rfc6265</a>&gt;.</dd></dl><div id="acknowledgements"><h2 id="rfc.section.A" class="np"><a href="#rfc.section.A">A.</a>&nbsp;<a href="#acknowledgements">Acknowledgements</a></h2><div id="rfc.section.A.p.1"><p>Thanks to Adam Langley and Giovanni Bajo for their explorations of Golumb-coded sets. In particular, see <a href="http://giovanni.bajo.it/post/47119962313/golomb-coded-sets-smaller-than-bloom-filters">http://giovanni.bajo.it/post/47119962313/golomb-coded-sets-smaller-than-bloom-filters</a>, which refers to sample code.</p></div></div><div class="avoidbreakinside"><h2 id="rfc.authors"><a href="#rfc.authors">Authors' Addresses</a></h2><p><b>Kazuho Oku</b><br>DeNA Co, Ltd.<br>EMail: <a href="mailto:kazuhooku@gmail.com">kazuhooku@gmail.com</a></p><p><b>Mark Nottingham</b><br>EMail: <a href="mailto:mnot@mnot.net">mnot@mnot.net</a><br>URI: <a href="https://www.mnot.net/">https://www.mnot.net/</a></p></div></div></div></div><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script></body></html>