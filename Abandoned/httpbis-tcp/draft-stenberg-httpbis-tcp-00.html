<!DOCTYPE html
  PUBLIC "-//W3C//DTD HTML 4.01//EN" "about:legacy-compat">
<html lang="en"><head profile="http://dublincore.org/documents/2008/08/04/dc-html/"><meta http-equiv="Content-Type" content="text/html; charset=utf-8"><title>TCP Performance Tuning for HTTP</title><meta name="viewport" content="width=device-width, initial-scale=1"><link rel="stylesheet" type="text/css" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css"><style type="text/css">
      body {
        padding-top: 80px;
        padding-bottom: 80px;
        position: relative;
      }
      .table.header th, .table.header td {
        border-top: none;
        padding: 0;
      }
      #rfc\.meta {
        width: 40%;
        float: right
      }
      #rfc\.toc > ul li {
        list-style: none;
      }
      .container .nav-sublist {
        padding-left: 20px;
        padding-right: 10px;
        font-size: 90%;
      }
      .container .navbar-brand {
        padding-top: 0;
      }
      .container .nav > li > a {
        padding: 10px 7px 5px 15px;
        display: inline-block;
      }
      .container .nav > li > a + a {
        padding: 10px 15px 5px 7px;
        display: inline-block;
      }
      .container .nav > li > a {
        padding: 5px 10px;
      }
      .filename {
        text-align: center;
      }
      dl {
        margin-left: 1em;
      }
      dl.dl-horizontal: {
        margin-left: 0;
      }
      dl > dt {
        float: left;
        margin-right: 1em;
      }
      dl.nohang > dt {
        float: none;
      }
      dl > dd {
        margin-bottom: .5em;
      }
      dl.compact > dd {
        margin-bottom: 0em;
      }
      dl > dd > dl {
        margin-top: 0.5em;
        margin-bottom: 0em;
      }
      td.reference {
        padding-right: 1em;
        vertical-align: top;
      }
      .feedback {
        position: fixed;
        bottom: 5px;
        right: 5px;
      }
      .fbbutton {
        margin-left: 5px;
      }
    </style><link rel="Author" href="#rfc.authors"><link rel="Copyright" href="#rfc.copyrightnotice"><link rel="Chapter" title="1 Introduction" href="#rfc.section.1"><link rel="Chapter" title="2 TCP Fast Open" href="#rfc.section.2"><link rel="Chapter" title="3 Initial Congestion Window" href="#rfc.section.3"><link rel="Chapter" title="4 Packet Pacing" href="#rfc.section.4"><link rel="Chapter" title="5 Explicit Congestion Control" href="#rfc.section.5"><link rel="Chapter" title="6 Tail Loss Probes" href="#rfc.section.6"><link rel="Chapter" title="7 Slow Start after Idle" href="#rfc.section.7"><link rel="Chapter" title="8 Nagle’s Algorithm" href="#rfc.section.8"><link rel="Chapter" title="9 Half-close" href="#rfc.section.9"><link rel="Chapter" title="10 Abort" href="#rfc.section.10"><link rel="Chapter" title="11 Keep-alive" href="#rfc.section.11"><link rel="Chapter" title="12 IANA Considerations" href="#rfc.section.12"><link rel="Chapter" title="13 Security Considerations" href="#rfc.section.13"><link rel="Chapter" href="#rfc.section.14" title="14 References"><meta name="generator" content="https://github.com/mnot/RFCBootstrap XSLT vendor: SAXON 9.1.0.8 from Saxonica http://www.saxonica.com/"><meta name="keywords" content="Internet-Draft"><link rel="schema.dct" href="http://purl.org/dc/terms/"><meta name="dct.creator" content="Stenberg, D."><meta name="dct.identifier" content="urn:ietf:id:draft-stenberg-httpbis-tcp-00"><meta name="dct.issued" scheme="ISO8601" content="2015-10-01"><meta name="dct.abstract" content="This document records current best practice for using all versions of HTTP over TCP."><meta name="description" content="This document records current best practice for using all versions of HTTP over TCP."></head><body><div class="container" id="top"><div class="row"><div class="col-md-4 col-md-push-8 hidden-sm hidden-xs" role="navigation"><div class="navbar"><div class="navbar-brand"><a href="#top">Internet-Draft</a></div><br clear="all"><div class=""><div id="rfc.toc"><ul class="nav"><li><a href="#rfc.section.1">1.</a>&nbsp;&nbsp;&nbsp;<a href="#introduction">Introduction</a><ul><li><a href="#rfc.section.1.1">1.1</a>&nbsp;&nbsp;&nbsp;<a href="#notational-conventions">Notational Conventions</a></li></ul></li><li><a href="#rfc.section.2">2.</a>&nbsp;&nbsp;&nbsp;<a href="#tcp-fast-open">TCP Fast Open</a></li><li><a href="#rfc.section.3">3.</a>&nbsp;&nbsp;&nbsp;<a href="#initial-congestion-window">Initial Congestion Window</a></li><li><a href="#rfc.section.4">4.</a>&nbsp;&nbsp;&nbsp;<a href="#packet-pacing">Packet Pacing</a></li><li><a href="#rfc.section.5">5.</a>&nbsp;&nbsp;&nbsp;<a href="#explicit-congestion-control">Explicit Congestion Control</a></li><li><a href="#rfc.section.6">6.</a>&nbsp;&nbsp;&nbsp;<a href="#tail-loss-probes">Tail Loss Probes</a></li><li><a href="#rfc.section.7">7.</a>&nbsp;&nbsp;&nbsp;<a href="#slow-start-after-idle">Slow Start after Idle</a></li><li><a href="#rfc.section.8">8.</a>&nbsp;&nbsp;&nbsp;<a href="#nagles-algorithm">Nagle’s Algorithm</a></li><li><a href="#rfc.section.9">9.</a>&nbsp;&nbsp;&nbsp;<a href="#half-close">Half-close</a></li><li><a href="#rfc.section.10">10.</a>&nbsp;&nbsp;&nbsp;<a href="#abort">Abort</a></li><li><a href="#rfc.section.11">11.</a>&nbsp;&nbsp;&nbsp;<a href="#keep-alive">Keep-alive</a></li><li><a href="#rfc.section.12">12.</a>&nbsp;&nbsp;&nbsp;<a href="#iana-considerations">IANA Considerations</a></li><li><a href="#rfc.section.13">13.</a>&nbsp;&nbsp;&nbsp;<a href="#security-considerations">Security Considerations</a></li><li><a href="#rfc.section.14">14.</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references">References</a><ul><li><a href="#rfc.section.14.1">14.1</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references.1">Normative References</a></li><li><a href="#rfc.section.14.2">14.2</a>&nbsp;&nbsp;&nbsp;<a href="#rfc.references.2">Informative References</a></li></ul></li><li><a href="#rfc.authors">Author's Address</a></li></ul></div></div></div></div><div class="col-md-8 col-md-pull-4 main" role="main"><table class="table table-condensed header" id="rfc.headerblock"><tbody><tr><td class="text-left">Network Working Group</td><td class="text-right">D. Stenberg</td></tr><tr><td class="text-left">Internet-Draft</td><td class="text-right">October 1, 2015</td></tr><tr><td class="text-left">Intended status: Best Current Practice</td><td class="text-right"></td></tr><tr><td class="text-left">Expires: April 3, 2016</td><td class="text-right"></td></tr></tbody></table><div id="rfc.title"><h1>TCP Performance Tuning for HTTP</h1><p class="filename">draft-stenberg-httpbis-tcp-00</p></div><hr><h2 id="rfc.abstract"><a href="#rfc.abstract">Abstract</a></h2><div class="lead"><p>This document records current best practice for using all versions of HTTP over TCP.</p></div><div id="rfc.status"><h2><a href="#rfc.status">Status of this Memo</a></h2><p>This Internet-Draft is submitted in full conformance with the provisions of BCP 78 and BCP 79.</p><p>Internet-Drafts are working documents of the Internet Engineering Task Force (IETF). Note that other groups may also distribute working documents as Internet-Drafts. The list of current Internet-Drafts is at <a href="http://datatracker.ietf.org/drafts/current/">http://datatracker.ietf.org/drafts/current/</a>.</p><p>Internet-Drafts are draft documents valid for a maximum of six months and may be updated, replaced, or obsoleted by other documents at any time. It is inappropriate to use Internet-Drafts as reference material or to cite them other than as “work in progress”.</p><p>This Internet-Draft will expire on April 3, 2016.</p></div><div id="rfc.copyrightnotice"><h2><a href="#rfc.copyrightnotice">Copyright Notice</a></h2><p>Copyright © 2015 IETF Trust and the persons identified as the document authors. All rights reserved.</p><p>This document is subject to BCP 78 and the IETF Trust's Legal Provisions Relating to IETF Documents (<a href="http://trustee.ietf.org/license-info">http://trustee.ietf.org/license-info</a>) in effect on the date of publication of this document. Please review these documents carefully, as they describe your rights and restrictions with respect to this document. Code Components extracted from this document must include Simplified BSD License text as described in Section 4.e of the Trust Legal Provisions and are provided without warranty as described in the Simplified BSD License.</p></div><div id="introduction"><h2 id="rfc.section.1" class="np"><a href="#rfc.section.1">1.</a>&nbsp;<a href="#introduction">Introduction</a></h2><div id="rfc.section.1.p.1"><p>HTTP <a href="#RFC7230"><cite title="Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing">[RFC7230]</cite></a> is currently defined to use TCP <a href="#RFC0793"><cite title="Transmission Control Protocol">[RFC0793]</cite></a>, and its performance can depend greatly upon how TCP is configured. This document records best current practice for using HTTP over TCP, with a focus on improving end-user perceived performance.</p></div><div id="rfc.section.1.p.2"><p>These practices are generally applicable to HTTP/1 as well as HTTP/2, although some may note particular impact or nuance regarding a particular protocol version.</p></div><div id="notational-conventions"><h3 id="rfc.section.1.1"><a href="#rfc.section.1.1">1.1</a>&nbsp;<a href="#notational-conventions">Notational Conventions</a></h3><div id="rfc.section.1.1.p.1"><p>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”, “RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as described in <a href="#RFC2119"><cite title="Key words for use in RFCs to Indicate Requirement Levels">[RFC2119]</cite></a>.</p></div></div></div><div id="tcp-fast-open"><h2 id="rfc.section.2"><a href="#rfc.section.2">2.</a>&nbsp;<a href="#tcp-fast-open">TCP Fast Open</a></h2><div id="rfc.section.2.p.1"><p>TCP Fast Open (a.k.a. TFO, <a href="#RFC7430"><cite title="Analysis of Residual Threats and Possible Fixes for Multipath TCP (MPTCP)">[RFC7430]</cite></a>) allows data to be sent on the TCP handshake, thereby allowing a request to be sent without any delay if a connection is not open.</p></div><div id="rfc.section.2.p.2"><p>TFO requires both client and server support, and additionally requires application knowledge, because the data sent on the SYN cannot be idempotent. Therefore, TFO can only be used on non-idempotent, safe methods (e.g., GET and HEAD), or with intervening negotiation (e.g, using TLS).</p></div><div id="rfc.section.2.p.3"><p>Support for TFO is growing in client platforms, especially mobile, due to the significant performance advantage it gives.</p></div></div><div id="initial-congestion-window"><h2 id="rfc.section.3"><a href="#rfc.section.3">3.</a>&nbsp;<a href="#initial-congestion-window">Initial Congestion Window</a></h2><div id="rfc.section.3.p.1"><p><a href="#RFC6928"><cite title="Increasing TCP's Initial Window">[RFC6928]</cite></a> specifies an initial congestion window of 10, and is now fairly widely deployed server-side. There has been experimentation with larger initial windows, in combination with packet pacing.</p></div></div><div id="packet-pacing"><h2 id="rfc.section.4"><a href="#rfc.section.4">4.</a>&nbsp;<a href="#packet-pacing">Packet Pacing</a></h2><div id="rfc.section.4.p.1"><p>TBD</p></div></div><div id="explicit-congestion-control"><h2 id="rfc.section.5"><a href="#rfc.section.5">5.</a>&nbsp;<a href="#explicit-congestion-control">Explicit Congestion Control</a></h2><div id="rfc.section.5.p.1"><p>Apple <a href="https://developer.apple.com/videos/wwdc/2015/?id=719">deploying in iOS and OSX</a>.</p></div></div><div id="tail-loss-probes"><h2 id="rfc.section.6"><a href="#rfc.section.6">6.</a>&nbsp;<a href="#tail-loss-probes">Tail Loss Probes</a></h2><div id="rfc.section.6.p.1"><p><a href="http://tools.ietf.org/html/draft-dukkipati-tcpm-tcp-loss-probe-01">draft</a></p></div></div><div id="slow-start-after-idle"><h2 id="rfc.section.7"><a href="#rfc.section.7">7.</a>&nbsp;<a href="#slow-start-after-idle">Slow Start after Idle</a></h2><div id="rfc.figure.u.1"><pre>
net.ipv4.tcp_slow_start_after_idle = 0
</pre></div></div><div id="nagles-algorithm"><h2 id="rfc.section.8"><a href="#rfc.section.8">8.</a>&nbsp;<a href="#nagles-algorithm">Nagle’s Algorithm</a></h2><div id="rfc.section.8.p.1"><p>Most implementations disable</p></div></div><div id="half-close"><h2 id="rfc.section.9"><a href="#rfc.section.9">9.</a>&nbsp;<a href="#half-close">Half-close</a></h2><div id="rfc.section.9.p.1"><p>Client or server is free to half-close after a request or response has been completed; or when there is no pending stream in HTTP/2.</p></div></div><div id="abort"><h2 id="rfc.section.10"><a href="#rfc.section.10">10.</a>&nbsp;<a href="#abort">Abort</a></h2><div id="rfc.section.10.p.1"><p>No client abort for HTTP/1.1 after the request body has been sent. Delayed full close is expected following an error response to avoid RST on the client.</p></div></div><div id="keep-alive"><h2 id="rfc.section.11"><a href="#rfc.section.11">11.</a>&nbsp;<a href="#keep-alive">Keep-alive</a></h2><div id="rfc.section.11.p.1"><p>TCP keep-alive likely disabled. App-level keep-alive is required for long-lived requests to detect failed peers.</p></div></div><div id="iana-considerations"><h2 id="rfc.section.12"><a href="#rfc.section.12">12.</a>&nbsp;<a href="#iana-considerations">IANA Considerations</a></h2><div id="rfc.section.12.p.1"><p>This document does not require action from IANA.</p></div></div><div id="security-considerations"><h2 id="rfc.section.13"><a href="#rfc.section.13">13.</a>&nbsp;<a href="#security-considerations">Security Considerations</a></h2></div><h2 id="rfc.references"><a id="rfc.section.14" href="#rfc.section.14">14.</a> References</h2><h3 id="rfc.references.1"><a href="#rfc.section.14.1" id="rfc.section.14.1">14.1</a> Normative References</h3><table><tr><td class="reference"><b id="RFC0793">[RFC0793]</b></td><td class="top">Postel, J., “<a href="http://www.rfc-editor.org/info/rfc793">Transmission Control Protocol</a>”, STD&nbsp;7, RFC&nbsp;793, <a href="http://dx.doi.org/10.17487/RFC0793">DOI&nbsp;10.17487/RFC0793</a>, September&nbsp;1981, &lt;<a href="http://www.rfc-editor.org/info/rfc793">http://www.rfc-editor.org/info/rfc793</a>&gt;.</td></tr><tr><td class="reference"><b id="RFC2119">[RFC2119]</b></td><td class="top"><a href="mailto:sob@harvard.edu">Bradner, S.</a>, “<a href="https://tools.ietf.org/html/rfc2119">Key words for use in RFCs to Indicate Requirement Levels</a>”, BCP&nbsp;14, RFC&nbsp;2119, <a href="http://dx.doi.org/10.17487/RFC2119">DOI&nbsp;10.17487/RFC2119</a>, March&nbsp;1997, &lt;<a href="http://www.rfc-editor.org/info/rfc2119">http://www.rfc-editor.org/info/rfc2119</a>&gt;.</td></tr><tr><td class="reference"><b id="RFC7230">[RFC7230]</b></td><td class="top">Fielding, R., Ed. and J. Reschke, Ed., “<a href="http://www.rfc-editor.org/info/rfc7230">Hypertext Transfer Protocol (HTTP/1.1): Message Syntax and Routing</a>”, RFC&nbsp;7230, <a href="http://dx.doi.org/10.17487/RFC7230">DOI&nbsp;10.17487/RFC7230</a>, June&nbsp;2014, &lt;<a href="http://www.rfc-editor.org/info/rfc7230">http://www.rfc-editor.org/info/rfc7230</a>&gt;.</td></tr></table><h3 id="rfc.references.2"><a href="#rfc.section.14.2" id="rfc.section.14.2">14.2</a> Informative References</h3><table><tr><td class="reference"><b id="RFC6928">[RFC6928]</b></td><td class="top">Chu, J., Dukkipati, N., Cheng, Y., and M. Mathis, “<a href="http://www.rfc-editor.org/info/rfc6928">Increasing TCP's Initial Window</a>”, RFC&nbsp;6928, <a href="http://dx.doi.org/10.17487/RFC6928">DOI&nbsp;10.17487/RFC6928</a>, April&nbsp;2013, &lt;<a href="http://www.rfc-editor.org/info/rfc6928">http://www.rfc-editor.org/info/rfc6928</a>&gt;.</td></tr><tr><td class="reference"><b id="RFC7430">[RFC7430]</b></td><td class="top">Bagnulo, M., Paasch, C., Gont, F., Bonaventure, O., and C. Raiciu, “<a href="http://www.rfc-editor.org/info/rfc7430">Analysis of Residual Threats and Possible Fixes for Multipath TCP (MPTCP)</a>”, RFC&nbsp;7430, <a href="http://dx.doi.org/10.17487/RFC7430">DOI&nbsp;10.17487/RFC7430</a>, July&nbsp;2015, &lt;<a href="http://www.rfc-editor.org/info/rfc7430">http://www.rfc-editor.org/info/rfc7430</a>&gt;.</td></tr></table><div class="avoidbreakinside"><h2 id="rfc.authors"><a href="#rfc.authors">Author's Address</a></h2><p><b>Daniel Stenberg</b><br>EMail: <a href="mailto:daniel@haxx.se">daniel@haxx.se</a><br>URI: <a href="http://daniel.haxx.se">http://daniel.haxx.se</a></p></div></div></div></div><script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script><script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script></body></html>