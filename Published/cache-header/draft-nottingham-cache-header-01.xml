<?xml version="1.0" encoding="UTF-8"?>
  <?xml-stylesheet type="text/xsl" href="rfc2629.xslt" ?>
  <!-- generated by https://github.com/cabo/kramdown-rfc2629 version 1.2.9 -->

<!DOCTYPE rfc SYSTEM "../Tools/rfcbootstrap/rfc2629.dtd" [
]>

<?rfc toc="yes"?>
<?rfc tocindent="yes"?>
<?rfc sortrefs="yes"?>
<?rfc symrefs="yes"?>
<?rfc strict="yes"?>
<?rfc compact="yes"?>
<?rfc comments="yes"?>
<?rfc inline="yes"?>

<rfc ipr="trust200902" docName="draft-nottingham-cache-header-00" category="std">

  <front>
    <title abbrev="Cache Header">The Cache HTTP Response Header</title>

    <author initials="M." surname="Nottingham" fullname="Mark Nottingham">
      <organization>Fastly</organization>
      <address>
        <email>mnot@mnot.net</email>
        <uri>https://www.mnot.net/</uri>
      </address>
    </author>

    <date year="2018"/>

    <area>General</area>
    
    <keyword>Internet-Draft</keyword>

    <abstract>


<t>To aid debugging, HTTP caches often append headers to a response detailing how they handled the request. This specification codifies that practice and updates it for HTTP’s current caching model.</t>



    </abstract>


    <note title="Note to Readers">


<t><spanx style="emph">RFC EDITOR: please remove this section before publication</spanx></t>

<t>The issues list for this draft can be found at <eref target="https://github.com/mnot/I-D/labels/cache-header">https://github.com/mnot/I-D/labels/cache-header</eref>.</t>

<t>The most recent (often, unpublished) draft is at <eref target="https://mnot.github.io/I-D/cache-header/">https://mnot.github.io/I-D/cache-header/</eref>.</t>

<t>Recent changes are listed at <eref target="https://github.com/mnot/I-D/commits/gh-pages/cache-header">https://github.com/mnot/I-D/commits/gh-pages/cache-header</eref>.</t>

<t>See also the draft’s current status in the IETF datatracker, at
<eref target="https://datatracker.ietf.org/doc/draft-nottingham-cache-header/">https://datatracker.ietf.org/doc/draft-nottingham-cache-header/</eref>.</t>


    </note>


  </front>

  <middle>


<section anchor="introduction" title="Introduction">

<t>To aid debugging, HTTP caches often append headers to a response detailing how they handled the request.</t>

<t>Unfortunately, the semantics of these headers are often unclear, and both the semantics and syntax used vary greatly between implementations.</t>

<t>This specification defines a single, new HTTP response header field, “Cache” for this purpose.</t>

<t>For example:</t>

<figure><artwork type="example"><![CDATA[
Cache: HIT_FRESH; node="reverse-proxy.example.com:80";
                  key="https://example.com/foo|Accept-Encoding:gzip",
       HIT_STALE; node="FooCDN parent"; fresh=-45; age=200; latency=3,
       MISS; node="FooCDN edge"; fresh=-45; age=200; latency=98
]]></artwork></figure>

<section anchor="notational-conventions" title="Notational Conventions">

<t>The key words “MUST”, “MUST NOT”, “REQUIRED”, “SHALL”, “SHALL NOT”, “SHOULD”, “SHOULD NOT”,
“RECOMMENDED”, “NOT RECOMMENDED”, “MAY”, and “OPTIONAL” in this document are to be interpreted as
described in BCP 14 <xref target="RFC2119"/> <xref target="RFC8174"/> when, and only when, they appear in all capitals, as
shown here.</t>

<t>This document uses ABNF as defined in <xref target="RFC5234"/>, along with the “%s” extension for case sensitivity defined in <xref target="RFC7405"/>.</t>

</section>
</section>
<section anchor="the-cache-http-response-header" title="The Cache HTTP Response Header">

<t>The Cache HTTP response header indicates the handling of the request corresponding to the response it occurs within by caches along the path.</t>

<t>Its value is a Parameterised List <xref target="I-D.ietf-httpbis-header-structure"/>:</t>

<figure><artwork type="abnf"><![CDATA[
Cache   = sh-param-list
]]></artwork></figure>

<t>Each member of the parameterised list represents a cache that has handled the request.</t>

<t>The first member of the list represents the cache closest to the origin server, and the last member of the list represents the cache closest to the user agent (possibly including the user agent’s cache itself, if it chooses to append a value).</t>

<t>Caches determine when it is appropriate to add the Cache header field to a response. Some might decide to add it to all responses, whereas others might only do so when specifically configured to, or when the request contains a header that activates a debugging mode.</t>

<t>When adding a value to the Cache header field, caches SHOULD preserve the existing contents of the header, to allow debugging of the entire chain of caches handling the request.</t>

<t>Identifiers in the parameterised list members are expected to be cache-actions:</t>

<figure><artwork type="abnf"><![CDATA[
cache-action   = %s"HIT_FRESH"
               / %s"HIT_STALE"
               / %s"HIT_REFRESH_MODIFIED"
               / %s"HIT_REFRESH_NOT_MODIFIED"
               / %s"HIT_REFRESH_STALE"
               / %s"MISS"
               / %s"MISS_CLIENT"
               / %s"BYPASS"
               / %s"ERROR"
]]></artwork></figure>

<t>The semantics of cache-actions are:</t>

<t><list style="symbols">
  <t>HIT_FRESH - The cache used a fresh stored response to satisfy the request without going forward</t>
  <t>HIT_STALE - The cache used a stale stored response to satisfy the request without going forward</t>
  <t>HIT_REFRESH_MODIFIED - The cache had a stale stored response, went forward to validate it, and used the new response to satisfy the request</t>
  <t>HIT_REFRESH_NOT_MODIFIED - The cache had a stale stored response, went forward to validate it, and used the stored response to satisfy the request</t>
  <t>HIT_REFRESH_STALE - The cache had a stale stored response, went forward to validate it, and encountered a problem, so the stored response was used to satisfy the request</t>
  <t>MISS - The cache did not have a stored response, so the request was forwarded</t>
  <t>MISS_CLIENT - The client included request directives (e.g., Pragma, Cache-Control) that prevented the cache from returning a response, so the request was forwarded</t>
  <t>BYPASS - The cache was configured to forward the request without attempting to use a stored response</t>
  <t>ERROR - The cache was unable to use a stored response or obtain one by going forward</t>
</list></t>

<t>Caches SHOULD use the most specific cache-action to a given response, but are not required to use all cache-actions. Future updates to this specification can add additional cache-actions.</t>

<t>Each member of the Cache header can also have any (or all, or none) of the following parameters:</t>

<figure><artwork type="abnf"><![CDATA[
node           = sh-string
fresh          = sh-integer
age            = sh-integer
cacheable      = sh-boolean
key            = sh-string
latency        = sh-integer
cl_nm          = sh-boolean
]]></artwork></figure>

<t>Their semantics are:</t>

<t><list style="symbols">
  <t>“node” - a string identifying for the cache node. MAY be a hostname, IP address, or alias.</t>
  <t>“fresh” - an integer indicating the cache’s estimation of the freshness lifetime (<xref target="RFC7234"/>, Section 4.2.1) of this response in seconds, including any locally applied configuration. MAY be negative.</t>
  <t>“age” - an integer indicating the cache’s estimation of the age (<xref target="RFC7234"/>, Section 4.2.3) of this response in seconds. MUST be 0 or greater.</t>
  <t>“cacheable” - a boolean indicating whether the cache can store this response, according to <xref target="RFC7234"/>, Section 3 and any locally applied configuration.</t>
  <t>“key” - a string representing the key that the cache has associated with this response. This might include the request URL, request headers, and other values.</t>
  <t>“latency” - an integer indicating the amount of time in milliseconds between the receipt of a complete set of request headers and sending the complete set of response headers of this response, from the viewpoint of the cache. Note that this may not include buffering time in transport protocols and similar delays.</t>
  <t>“cl_nm” - a boolean indicating whether the response to the client had a 304 Not Modified status code.</t>
</list></t>

<t>While all of these parameters are OPTIONAL, caches are encouraged to use the ‘node’ parameter to identify themselves.</t>

</section>
<section anchor="security-considerations" title="Security Considerations">

<t>Information about a cache’s content can be used to infer the activity of those using it. Generally, access to sensitive information in a cache is limited to those who are authorised to access that information (using a variety of techniques), so this does not represent an attack vector in the general sense.</t>

<t>However, if the Cache header is exposed to parties who are not authorised to obtain the response it occurs within, it could expose information about that data.</t>

<t>For example, if an attacker were able to obtain the Cache header from a response containing sensitive information and access were limited to one person (or limited set of people), they could determine whether that information had been accessed before. This is similar to the information exposed by various timing attacks, but is arguably more reliable, since the cache is directly reporting its state.</t>

<t>Mitigations include use of encryption (e.g., TLS <xref target="RFC8446"/>)) to protect the response, and careful controls over access to response headers (as are present in the Web platform). When in doubt, the Cache header field can be omitted.</t>

</section>


  </middle>

  <back>

    <references title='Normative References'>





<reference  anchor="RFC2119" target='https://www.rfc-editor.org/info/rfc2119'>
<front>
<title>Key words for use in RFCs to Indicate Requirement Levels</title>
<author initials='S.' surname='Bradner' fullname='S. Bradner'><organization /></author>
<date year='1997' month='March' />
<abstract><t>In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized. This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t></abstract>
</front>
<seriesInfo name='BCP' value='14'/>
<seriesInfo name='RFC' value='2119'/>
<seriesInfo name='DOI' value='10.17487/RFC2119'/>
</reference>



<reference  anchor="RFC8174" target='https://www.rfc-editor.org/info/rfc8174'>
<front>
<title>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</title>
<author initials='B.' surname='Leiba' fullname='B. Leiba'><organization /></author>
<date year='2017' month='May' />
<abstract><t>RFC 2119 specifies common key words that may be used in protocol  specifications.  This document aims to reduce the ambiguity by clarifying that only UPPERCASE usage of the key words have the  defined special meanings.</t></abstract>
</front>
<seriesInfo name='BCP' value='14'/>
<seriesInfo name='RFC' value='8174'/>
<seriesInfo name='DOI' value='10.17487/RFC8174'/>
</reference>



<reference  anchor="RFC5234" target='https://www.rfc-editor.org/info/rfc5234'>
<front>
<title>Augmented BNF for Syntax Specifications: ABNF</title>
<author initials='D.' surname='Crocker' fullname='D. Crocker' role='editor'><organization /></author>
<author initials='P.' surname='Overell' fullname='P. Overell'><organization /></author>
<date year='2008' month='January' />
<abstract><t>Internet technical specifications often need to define a formal syntax.  Over the years, a modified version of Backus-Naur Form (BNF), called Augmented BNF (ABNF), has been popular among many Internet specifications.  The current specification documents ABNF. It balances compactness and simplicity with reasonable representational power.  The differences between standard BNF and ABNF involve naming rules, repetition, alternatives, order-independence, and value ranges.  This specification also supplies additional rule definitions and encoding for a core lexical analyzer of the type common to several Internet specifications.  [STANDARDS-TRACK]</t></abstract>
</front>
<seriesInfo name='STD' value='68'/>
<seriesInfo name='RFC' value='5234'/>
<seriesInfo name='DOI' value='10.17487/RFC5234'/>
</reference>



<reference  anchor="RFC7405" target='https://www.rfc-editor.org/info/rfc7405'>
<front>
<title>Case-Sensitive String Support in ABNF</title>
<author initials='P.' surname='Kyzivat' fullname='P. Kyzivat'><organization /></author>
<date year='2014' month='December' />
<abstract><t>This document extends the base definition of ABNF (Augmented Backus-Naur Form) to include a way to specify US-ASCII string literals that are matched in a case-sensitive manner.</t></abstract>
</front>
<seriesInfo name='RFC' value='7405'/>
<seriesInfo name='DOI' value='10.17487/RFC7405'/>
</reference>



<reference anchor="I-D.ietf-httpbis-header-structure">
<front>
<title>Structured Headers for HTTP</title>

<author initials='M' surname='Nottingham' fullname='Mark Nottingham'>
    <organization />
</author>

<author initials='P' surname='Kamp' fullname='Poul-Henning Kamp'>
    <organization />
</author>

<date month='July' day='2' year='2018' />

<abstract><t>This document describes a set of data types and algorithms associated with them that are intended to make it easier and safer to define and handle HTTP header fields.  It is intended for use by new specifications of HTTP header fields as well as revisions of existing header field specifications when doing so does not cause interoperability issues.</t></abstract>

</front>

<seriesInfo name='Internet-Draft' value='draft-ietf-httpbis-header-structure-07' />
<format type='TXT'
        target='http://www.ietf.org/internet-drafts/draft-ietf-httpbis-header-structure-07.txt' />
</reference>



<reference  anchor="RFC7234" target='https://www.rfc-editor.org/info/rfc7234'>
<front>
<title>Hypertext Transfer Protocol (HTTP/1.1): Caching</title>
<author initials='R.' surname='Fielding' fullname='R. Fielding' role='editor'><organization /></author>
<author initials='M.' surname='Nottingham' fullname='M. Nottingham' role='editor'><organization /></author>
<author initials='J.' surname='Reschke' fullname='J. Reschke' role='editor'><organization /></author>
<date year='2014' month='June' />
<abstract><t>The Hypertext Transfer Protocol (HTTP) is a stateless \%application- level protocol for distributed, collaborative, hypertext information systems.  This document defines HTTP caches and the associated header fields that control cache behavior or indicate cacheable response messages.</t></abstract>
</front>
<seriesInfo name='RFC' value='7234'/>
<seriesInfo name='DOI' value='10.17487/RFC7234'/>
</reference>




    </references>

    <references title='Informative References'>





<reference  anchor="RFC8446" target='https://www.rfc-editor.org/info/rfc8446'>
<front>
<title>The Transport Layer Security (TLS) Protocol Version 1.3</title>
<author initials='E.' surname='Rescorla' fullname='E. Rescorla'><organization /></author>
<date year='2018' month='August' />
<abstract><t>This document specifies version 1.3 of the Transport Layer Security (TLS) protocol.  TLS allows client/server applications to communicate over the Internet in a way that is designed to prevent eavesdropping, tampering, and message forgery.</t><t>This document updates RFCs 5705 and 6066, and obsoletes RFCs 5077, 5246, and 6961.  This document also specifies new requirements for TLS 1.2 implementations.</t></abstract>
</front>
<seriesInfo name='RFC' value='8446'/>
<seriesInfo name='DOI' value='10.17487/RFC8446'/>
</reference>




    </references>



  </back>

<!-- ##markdown-source:
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
ivBg4Fb4tfk9cAY7Jv8C7+p9pcQeAAA=

-->

</rfc>

